# Работа с клиентами

* [Получение клиентов](#Получение-клиентов)
* [Поиск купона клиента](#Поиск-купона-клиента)
* [Поиск клиента по токену](#Поиск-клиента-по-токену)
* [Получение баланса клиента](#Получение-баланса-клиента)
* [Получение купонов клиента](#Получение-купонов-клиента)
* [Получение истории изменения баланса](#Получение-истории-изменения-баланса)
* [Списание купонов и баллов](#Списание-купонов-и-баллов)

## Получение клиентов
* **URL**

`/ext/api/v1/clients/`

* **Метод**

`GET`

* **URL параметры**

Название поля | Описание
------------- | --------
phone | Номер телефона. Часть передаваемой строки может быть заменена на %. Необязательный параметр.
email | Email клиента. Часть передаваемой строки может быть заменена на %. Необязательный параметр.
offset | Число. Порядковый номер с которого будет произведена выдача(начинается с 0). Необязательный параметр.
limit | Число. Ограничение на кол-во записей в выдаче. Необязательный параметр.

* **Параметры данных**

Отсутствуют

* **Пример ответа**

```json
[{
    "id" : 1234567,
    "email" : "test@test.ru",
    "phone" : "7912345678",
    "name" : "Client First",
    "avatarUrl": "https://test.com/image/123.jpg",
    "paidPurchases" : 1,
    "totalPurchases" : 2,
    "averageBill" : 100.5,
    "totalPurchasesAmount" : 1234.4,
    "paidPurchasesAmount": 123.5,
    "positiveReviews": 1,
    "neutralReviews": 0,
    "negativeReviews": 2,
    "token": "12345667890abcdef"
}]
     
```

* **Описание параметров ответа**

Название поля | Описание
------------- | --------
id | Идентификатор клиента
email | Email клиента. Может быть null
phone | Телефон клиента. Может быть null
name | Имя и фамилия клиента. Может быть null
avatarUrl | Абсолютный url с изображением. Может быть null
paidPurchases | Количество оплаченных заказов. От 0 и более
totalPurchases | Количество всех заказов. От 0 и более
averageBill | Средний чек
totalPurchasesAmount | Общая сумма всех заказов
paidPurchasesAmount | Общая сумма всех оплаченных заказов
positiveReviews | Количество положительных оценок
neutralReviews | Количество нейтральных оценок
negativeReviews | Количество негативных оценок
token | Уникальный токен клиента. hex. 32 символа

## Поиск купона клиента
* **URL**

`/ext/api/v1/clients/coupons/`

* **Метод**

`GET`

* **URL параметры**

Название поля | Описание
------------- | --------
type | linked &#124; shared &#124; merchant. linked - привязанный купон, shared - расшаренный купон, merchant - короткий код купона 
token | Токен купона. Может быть как короткий, так и длинный

* **Параметры данных**

Отсутствуют

* **Пример ответа**

```json
{
    "client" : {
        "id" : 1234567,
        "email" : "test@test.ru",
        "phone" : "7912345678",
        "name" : "Client First",
        "avatarUrl": "https://test.com/image/123.jpg",
        "paidPurchases" : 1,
        "totalPurchases" : 2,
        "averageBill" : 100.5,
        "totalPurchasesAmount" : 1234.4,
        "paidPurchasesAmount": 123.5,
        "positiveReviews": 1,
        "neutralReviews": 0,
        "negativeReviews": 2,
        "token": "12345667890abcdef"
    },
    "coupons" : {
        "id": 123,
        "title":"Internal title",
        "header":"Заголовок",
        "subHeader": "Подзаголовок",
        "shortDescription": "Короткое описание",
        "longDescription" : "Длинное описание",
        "expireDate": 1571408400000,
        "token" : "12345667890abcdef",
        "shareToken" :  "12345667890abcdef",
        "merchantToken": "123456",
        "merchantShareToken" : "654321"
    }
}
     
```

* **Описание параметров ответа**

Название поля | Описание
------------- | --------
client | см. описание получения клиента
coupon | см. описание получение купона

## Поиск клиента по токену
* **URL**

`/ext/api/v1/clients/{token}/`

* **Метод**

`GET`

* **URL параметры**

Название поля | Описание
------------- | --------
{token} | Уникальный токен клиента

* **Параметры данных**

Отсутствуют

* **Пример ответа**

```json
{
    "id" : 1234567,
    "email" : "test@test.ru",
    "phone" : "7912345678",
    "name" : "Client First",
    "avatarUrl": "https://test.com/image/123.jpg",
    "paidPurchases" : 1,
    "totalPurchases" : 2,
    "averageBill" : 100.5,
    "totalPurchasesAmount" : 1234.4,
    "paidPurchasesAmount": 123.5,
    "positiveReviews": 1,
    "neutralReviews": 0,
    "negativeReviews": 2,
    "token": "12345667890abcdef"
}
     
```

* **Описание параметров ответа**

см. описание получения клиента

## Получение баланса клиента
* **URL**

`/ext/api/v1/clients/{id}/balance/`

* **Метод**

`GET`

* **URL параметры**

Название поля | Описание
------------- | --------
{id} | Идентификатор клиента.

* **Параметры данных**

Отсутствуют

* **Пример ответа**

```json
[{
    "amount" : 1234.56,
    "currency" : "points"
}, {
    "amount" : 4321.06,
    "currency" : "rubles"
}]
     
```

* **Описание параметров ответа**

Название поля | Описание
------------- | --------
amount | Сумма доступная для списания.
currency | Валюта. Пока только points и rubles.

## Получение купонов клиента
* **URL**

`/ext/api/v1/clients/{id}/coupons/`

* **Метод**

`GET`

* **URL параметры**

Название поля | Описание
------------- | --------
{id} | Идентификатор клиента.

* **Параметры данных**

Отсутствуют

* **Пример ответа**

```json
[{
    "id": 123,
    "title":"Internal title",
    "header":"Заголовок",
    "subHeader": "Подзаголовок",
    "shortDescription": "Короткое описание",
    "longDescription" : "Длинное описание",
    "expireDate": 1571408400000,
    "token" : "12345667890abcdef",
    "shareToken" :  "12345667890abcdef",
    "merchantToken": "123456",
    "merchantShareToken" : "654321"
}]
     
```

* **Описание параметров ответа**

Название поля | Описание
------------- | --------
id | Идентификатор купона.
title | Служебный заголовок. Может отсутствовать.
header | Заголовок. Может отсутствовать.
subHeader | Подзаголовок. Может отсутствовать.
shortDescription | Короткое описание. Может отсутствовать. Может содержать html теги.
longDescription | Длинное описание. Может отсутствовать. Может содержать html теги.
expireDate | Время по которое купон валиден.
token | Токен до 32 символов. HEX. Уникальный токен пары клиент - купон. Генерируется iBonus.
shareToken | Токен до 32 символов. HEX. Уникальный токен пары клиент - купон для расшаривания. Используется в методе погашения расшаренного купона. Генерируется iBonus.
merchantToken | Токен до 32 символов. HEX. Уникальный токен пары клиент - купон. На данный момент генерируется iBonus. Шесть цифр.
merchantShareToken | Токен до 32 символов. HEX. Уникальный токен пары клиент - купон для расшаривания. На данный момент генерируется iBonus. Шесть цифр.


## Получение истории изменения баланса
* **URL**

`/ext/api/v1/clients/{id}/balance/history/`

* **Метод**

`GET`

* **URL параметры**

Название поля | Описание
------------- | --------
{id} | Идентификатор клиента.
from | Timestamp. Время транзакции будет больше, либо равно переданному значению. Необязательный параметр.
to | Timestamp. Время транзакции будет меньше, либо равно переданному значению. Необязательный параметр.
offset | Число. Порядковый номер с которого будет произведена выдача(начинается с 0). Необязательный параметр.
limit | Число. Ограничение на кол-во записей в выдаче. Необязательный параметр.

* **Параметры данных**

Отсутствуют

* **Пример ответа**

```json
[{
    "amount" : 1234.56,
    "currency" : "points",
    "transactionDate" : 1548968400000,
    "transactionId" : "123456789"
}]
     
```

* **Описание параметров ответа**

Название поля | Описание
------------- | --------
amount | Сумма транзакции.
currency | Валюта транзакции. Пока только points и rubles.
transactionDate | Timestamp. Дата транзакции.
transactionId | Идентификатор транзакции.

## Списание купонов и баллов
* **URL**

`/ext/api/v1/clients/{id}/balance/write_off/`

* **Метод**

`POST`

* **URL параметры**

Название поля | Описание
------------- | --------
{id} | Идентификатор клиента.

* **Параметры данных**

```json
{
    "balance": [{
        "amount" : 1234.56,
        "currency" : "points"
    }],
    "coupons" : [123, 321]
}
     
```

* **Описание параметров**

Название поля | Описание
------------- | --------
balance | Балансы с которых надо списать указанное количество. Может отсутствовать в запросе.
coupons | Купоны, которые необходимо погасить. Может отсутствовать в запросе.

* **Пример ответа**

200 OK

